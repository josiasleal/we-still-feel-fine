/*! We Still Feel Fine Client JS v0.0.1 | Copyright 2013 Lauren Sperber https://github.com/lauren/we-still-feel-fine/blob/master/LICENSE | we-still-feel-fine 2014-02-25 */
!function(){window.onload=function(){var a=io.connect(),b=[],c=function(){return Math.random()*document.documentElement.clientWidth-100},d=function(){return Math.random()*document.documentElement.clientHeight-100};a.on("feelingTweet",function(a){d3.select("#loading").length>0&&d3.select("#loading").transition().duration(200).style("opacity",0),b.push(a);var f,g=d3.select("svg"),j=g.selectAll("svg").data(b).enter().append("svg").attr({x:c(),y:d(),"data-feeling":a.feeling,"data-tweet":a.text,"data-user":a.user.screen_name,"data-userimage":a.user.profile_image_url,"data-tweetId":a.id_str,"data-feelingColor":a.feelingColor}).on("mouseenter",function(){h(this)}).on("mouseleave",function(){"selected"!==this.id&&e(this)}).on("click",function(){i(this)}).on("touchend",function(){i(this)}),k=j.append("g");b.length>1e3&&(f=b.shift(),g.selectAll("svg").data([f],function(a){return a}).remove()),k.append("circle").attr({cx:100,cy:100,r:0,fill:a.feelingColor,"class":"circle"}).transition().duration(200).attr("r",20)}),setInterval(function(){var a=d3.select("svg").selectAll("svg"),b=Math.floor(Math.random()*a.length),c=a[b][0];if(c){var d=document.createEvent("SVGEvents");d.initEvent("click",!0,!0),c.dispatchEvent(d),g(c)}},4e3);var e=function(a){a=a?d3.select(a):d3.selectAll("g"),a.attr("id",""),a.selectAll("text").remove(),a.select("circle").attr("class","circle").transition().duration(200).attr("r",20)},f=function(){d3.select("#tweet-detail").transition().duration(200).style("display","none")},g=function(a){d3.select(a).append("text").text(a.dataset.feeling).attr({x:100,y:100,"alignment-baseline":"middle","text-anchor":"middle","class":"shadow"}),d3.select(a).append("text").text(a.dataset.feeling).attr({x:100,y:100,"alignment-baseline":"middle","text-anchor":"middle","class":"label"})},h=function(a){a.parentNode.appendChild(a),"selected"!==a.id&&(d3.select(a).select("circle").transition().duration(200).attr("r",60),g(a))},i=function(a){"selected"===a.id?(e(a),f()):(e(document.getElementById("selected")),a.parentNode.appendChild(a),d3.select(a).attr("id","selected"),d3.select(a).select("circle").transition().duration(200).attr("r",100),d3.select("#user-link").attr("href","http://twitter.com/"+a.dataset.user),d3.select("#user-image").attr("src",a.dataset.userimage),d3.select("#username-link").text(a.dataset.user).attr("href","http://twitter.com/"+a.dataset.user),d3.select("#tweet-text").html(": "+a.dataset.tweet+" "),d3.select("#tweet-link").attr("href","http://twitter.com/"+a.dataset.user+"/status/"+a.dataset.tweetId),d3.select("#tweet-detail").transition().duration(200).style("display","block"))}}}();