/*! We Still Feel Fine Client JS v0.0.1 | Copyright 2013 Lauren Sperber https://github.com/lauren/we-still-feel-fine/blob/master/LICENSE | we-still-feel-fine 2013-08-14 */
!function(){window.onload=function(){var a=io.connect(),b=[],c=function(){return Math.random()*document.documentElement.clientWidth},d=function(){return Math.random()*document.documentElement.clientHeight},e=function(){return document.documentElement.clientHeight<document.documentElement.clientWidth?.25*document.documentElement.clientHeight:.25*document.documentElement.clientWidth};a.on("feelingTweet",function(a){b.push(a);var e=d3.select("svg"),g=e.selectAll("g").data(b).enter().append("g").attr({"data-feeling":a.feeling,"data-tweet":a.text,"data-user":a.user.screen_name,"data-userimage":a.user.profile_image_url,"data-tweetId":a.id_str,"data-feelingColor":a.feelingColor}).on("mouseenter",function(){h(this)}).on("mouseleave",function(){"selected"!==this.id&&f(this)}).on("click",function(){i(this)});if(b.length>2e3)var j=b.shift();e.selectAll("g").data([j],function(a){return a}).remove(),g.attr("transform",function(){var a=c(),b=d();return"translate("+[a,b]+")"}),g.append("circle").attr({r:0,fill:a.feelingColor,"class":"circle"}).transition().duration(200).attr("r",20)});var f=function(a){a=a?d3.select(a):d3.selectAll("g"),a.attr("id",""),a.selectAll("text").remove(),a.select("circle").attr("class","circle").transition().duration(200).attr("r",20)},g=function(){d3.select("#tweet-detail").transition().duration(200).style("display","none")},h=function(a){a.parentNode.appendChild(a),"selected"!==a.id&&(d3.select(a).select("circle").transition().duration(200).attr("r",60),d3.select(a).append("text").text(a.dataset.feeling).attr({"alignment-baseline":"middle","text-anchor":"middle","class":"shadow"}),d3.select(a).append("text").text(a.dataset.feeling).attr({"alignment-baseline":"middle","text-anchor":"middle","class":"label"}))},i=function(a){"selected"===a.id?(f(a),g()):(f(document.getElementById("selected")),a.parentNode.appendChild(a),d3.select(a).attr("id","selected"),d3.select(a).select("circle").transition().duration(200).attr("r",e),d3.select("#user-link").attr("href","http://twitter.com/"+a.dataset.user),d3.select("#user-image").attr("src",a.dataset.userimage),d3.select("#username-link").text(a.dataset.user).attr("href","http://twitter.com/"+a.dataset.user),d3.select("#tweet-text").html(": "+a.dataset.tweet+" "),d3.select("#tweet-link").attr("href","http://twitter.com/"+a.dataset.user+"/status/"+a.dataset.tweetId),d3.select("#tweet-detail").transition().duration(200).style("display","block"),d3.select(a).append("text").text(a.dataset.feeling).attr({"alignment-baseline":"middle","text-anchor":"middle","class":"shadow"}),d3.select(a).append("text").text(a.dataset.feeling).attr({"alignment-baseline":"middle","text-anchor":"middle","class":"label"}))}}}();